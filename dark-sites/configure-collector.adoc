---
sidebar: sidebar
permalink: dark-sites/configure-collector.html
keywords: configure, keystone, collector, private mode, darksite mode, tui utility
summary: Complete a few configuration tasks to enable Keystone Collector to collect usage data in an environment that does not have internet access, also known as a as a _dark site_ or _private mode_.
---
= Configure Keystone Collector in private mode
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

[.lead]
Complete a few configuration tasks to enable Keystone Collector to collect usage data in an environment that does not have internet access, also known as a as a _dark site_ or _private mode_. This is a one-time activity to activate and associate the required components with your storage environment.  Once configured, Keystone Collector will monitor all ONTAP clusters managed by Active IQ Unified Manager.

NOTE: Keystone Collector provides you with the Keystone Collector Management Terminal User Interface (TUI) utility to perform configuration and monitoring activities. You can use various keyboard controls, such as the Enter and arrow keys, to select the options and navigate across this TUI.

.Steps

. Start the Keystone Collector management TUI utility:
+
`keystone-collector-tui`
+
Keystone collector management console will initialize.
+
image:dark-sites-initialize.png[Keystone collector management console]
. To enable *Darksite mode*:
.. Select *Configure* and then select *Advanced*.
+
NOTE: Use "arrow" keys to navigate inside the console and "Enter" key for selection._
+
image:dark-site-enable.png[Enable darksite]
.. Navigate to the *Darksite Mode* option and press "Space" Key to select the option.
+
image:dark-site-mode.png[Darksite mode]]
.. Click *Save* to enable the configuration.
. To configure the *Keystone Collector*:
.. Select *Configure* from the homepage and select *KS Collector* to open the Keystone Collector configuration screen.
+
image:dark-site-configure.png[Configure Keystone Collector]
+
image:dark-site-kscollector.png[Keystone collector]
.. Toggle the *Start KS Collector with System* field using the "Space" Key.
.. Toggle the *Collect ONTAP Usage* field.
+
image:dark-site-collect-ontap-usage.png[Collect ONTAP Usage field]
.. Enter the details for the *Unified Manager*.
+
image:dark-site-unified-manager.png[Unified Manager field]
.. [Optional] Toggle the *Using Tiering Rate plans* checkbox in case data tiering is required for the subscription.
+
image:dark-site-using-tiering-rate-plans.png[Using Tiering Rate plans checkbox]
.. Based on the subscription type purchased, update the *Usage Type*.
+
NOTE: Before configuring, confirm the usage type associated with the subscription from NetApp.
+
image:dark-site-usage-type.png[Usage type option]
.. Click on *Save* to complete the configuration.
. To generate the collectorâ€™s *Public Keypair*:
.. Select *Configure* from the homepage and select *KS Collector* to open the Keystone Collector configuration screen
.. Navigate to *Encryption Key Manager* and press Enter.
+
image:dark-site-encryption-key-manager.png[Encryption Key Manager option]
.. Select *Generate Collector Keypair* and press Enter.
+
image:dark-site-generate-collector-keypair.png[Generate Collector Keypair option]

.. Validate that the Collector is in a Healthy State by returning to the main screen of the Keystone Collector TUI and inspect the Service Status information. Wait up to 10 minutes for the system to show that the services are Overall: Healthy. If after 10minutes the overall status is Unhealthy, review the previous configuration steps, and contact NetApp Keystone Support.
+
image:dark-site-service-status.png[Service status]

.. Exit the Keystone Collector TUI via *Exit to Shell* option.
.. Retrieve the generated public key:
+
`~/collector-public.pem`
+
.. Send an email with this file to keystone.services@netapp.com

== Export usage report
You should send the monthly usage summary report to NetApp at the end of every month. You can generate this report manually.

Follow these steps to generate usage report:

. Navigate to *Export Usage* on the Keystone Collector TUI homepage.
. Collect the files and send them to keystone.services@netapp.com.
+
Collector generates a clear file and an encrypted file which should be sent to NetApp manually. Clear file report has the following details which can be validated by the customer.
+
image:dark-site-clear-file-report.png[Clear file report]


== Upgrade ONTAP
Keystone Collector supports ONTAP upgrades through the TUI. 

Follow these steps to upgrade ONTAP:

. Select *Maintenance* from the TUI homepage and select *ONTAP Upgrade Webserver* option.
. Copy the ONTAP upgrade image file to */opt/netapp/ontap-upgrade/* and then start webserver by clicking on *Start Webserver*.
+
image:dark-site-start-webserver.png[Start Webserver option]
. Navigate to http://<collector-ip>:8000 using a Web Browser for upgrade assistance.

Refer to section 9-1.2 from the word doc.

== Restart Keystone Collector
You can restart the Keystone Collector service through the TUI. Follow this step:

. Select *Maintenance* from the TUI homepage and select *Restart Collector Services* option.
+
image:dark-site-restart-collector-services.png[Restart Collector Services option]
+
Performing this step will reboot all the collector services, and their status can be observed from the TUI homepage.

